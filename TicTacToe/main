require_relative 'Board'
require_relative 'Competitor'
require_relative 'Move'

def main
	game_setup
	players = [@player1, @player2].cycle
	players.next if player1_starts? == false
	loop do
		current_player = players.next
	  	play_turn(current_player)
		main if game_end?(current_player)
	end
end

def game_setup
	play_game?
	initialize_game
	get_number_players
	get_player_names
end

def initialize_game
	@board = Board.new
	@nextmove = Move.new
end

def play_game?
	puts 'Would you like to play Tic Tac Toe? Type Y to play.'
	if gets.chomp.upcase == 'Y' 
		true
	else 
		puts 'Goodbye!'
		exit
	end
end

def get_number_players
	puts 'How many players? Choose 1 or 2'
	if gets.to_i == 1
		@player1 = Competitor.new('X', 'Human')
		@player2 = Competitor.new('O', 'Computer')
	else
		@player1 = Competitor.new('X', 'Player 1')
		@player2 = Competitor.new('O', 'Player 2')
	end
end

def get_player_names
	if @player2.name == 'Computer'
		puts "What is your name?"
		@player1.name = gets.chomp
	else
		puts "What is player 1's name?"
		@player1.name = gets.chomp
		puts "What is player 2's name?"
		@player2.name = gets.chomp
	end
	puts "#{@player1.name} is #{@player1.letter}, #{@player2.name} is #{@player2.letter}"
end

def player1_starts?
	puts "Flipping coin to see who starts..."
	sleep 1
	if rand(2) == 0 
		puts "#{@player1.name} (#{@player1.letter}) to start"
		true
	else
		puts "#{@player2.name} (#{@player2.letter}) to start"
		false
	end
end

def play_turn(player)
	@board.print_board
	puts "#{player.name} (#{player.letter}) to go next"
	if player.name == 'Computer'
		@nextmove.computer_move(@board, player.letter, 1)
	else
		@nextmove.human_move(@board, player.letter)
	end
end

def game_end?(player)
	if @board.win?(player.letter)
	  	@board.print_board
	  	puts "#{player.name} (#{player.letter}) wins!"
	  	true
	elsif @board.draw?
	  	@board.print_board
	  	puts "draw"
	  	true
  	end
end

main
